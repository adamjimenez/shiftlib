function debug(log_txt){if(window.console!==undefined){console.log(log_txt);}}
(function($){$.fn.serializeAll=function(){var rselectTextarea=/^(?:select|textarea)/i;var rinput=/^(?:color|date|datetime|datetime-local|email|file|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;var rCRLF=/\r?\n/g;var arr=this.map(function(){return this.elements?jQuery.makeArray(this.elements):this;}).filter(function(){return this.name&&!this.disabled&&(this.checked||rselectTextarea.test(this.nodeName)||rinput.test(this.type));}).map(function(i,elem){var val=jQuery(this).val();return val===null?null:jQuery.isArray(val)?jQuery.map(val,function(val,i){return{name:elem.name,value:val.replace(rCRLF,"\r\n")};}):{name:elem.name,value:val.replace(rCRLF,"\r\n")};}).get();return $.param(arr);};})(jQuery);function remove_options(select)
{jQuery('option:not(:first-child)',select).remove();select.disabled=true;return true;}
function add_options(result,target_option,value)
{models=eval('('+result+')');var mod=target_option;var selectedIndex=0;if(!models){optval="";opttext="Not Applicable";mod.options[0]=new Option(opttext,optval,true,true);}else{for(i=0;i<models.length;i++){mod.options[i+1]=new Option(models[i],i,true,true);if(models[i].replace(/-/,'').toLowerCase()===value.replace(/-/,'').toLowerCase()){selectedIndex=i+1;}}
mod.options[0].value="";mod.options[0].text="";mod.disabled=false;}
mod.options.selectedIndex=selectedIndex;}
function showProgress(on){if(!jQuery.dialog){return;}
if(on){var dialog=jQuery("#progressDialog");if(jQuery("#progressDialog").length===0){dialog=jQuery('<div id="progressDialog" title="Loading">Please wait..</div>').appendTo('body');}
jQuery("#progressDialog").dialog({closeOnEscape:false,open:function(event,ui){jQuery(this).parent().children().children('.ui-dialog-titlebar-close').hide();},height:140,modal:true});}else{jQuery("#progressDialog").dialog("close");}}
function initForms()
{jQuery('form.validate').bind('submit',function(evt){evt.preventDefault();evt.stopPropagation();showProgress(true);jQuery('*[type=submit], *[type=image]',this).attr('disabled','');jQuery('div.error').remove();var url=location.href;if(this.action){url=this.action;}
jQuery.ajax(url,{dataType:'json',type:'post',data:jQuery(this).serializeAll()+'&validate=1&nospam=1',success:jQuery.proxy(function(returned){var errorMethod='inline';var firstError;if(jQuery(this).attr('data-errorMethod')){errorMethod=jQuery(this).attr('data-errorMethod');}else if(jQuery(this).attr('errorMethod')){errorMethod=jQuery(this).attr('errorMethod');}
debug(returned);showProgress(false);if(parseInt(returned,10)!==returned-0){if(returned.length>0){var errors='';for(i=0;i<returned.length;i++){var pos=returned[i].indexOf(' ');var field;var error;if(pos===-1){field=returned[i];error='Required';}else{field=returned[i].substring(0,pos);error=returned[i].substring(pos+1);}
var parent='';if(this[field]){if(this[field].style){if(!firstError){firstError=field;}
parent=this[field].parentNode;}else if(this[field][0]){parent=this[field][0].parentNode.parentNode;}
errors+=field+'\n';}else if(this[field+'[]']){if(this[field+'[]'].style){if(!firstError){firstError=field;}
parent=this[field+'[]'].parentNode;}else if(this[field+'[]'][0]){parent=this[field+'[]'][0].parentNode.parentNode;}
errors+=field+'\n';}else{errors+=error+'\n';}
if(parent&&errorMethod=='inline'){div=document.createElement("div");div.innerHTML=error;div.style.color='red';div.className='error';parent.appendChild(div);}}
if(errorMethod=='alert'){alert('Please check the required fields\n'+errors);}
var tab,node;node=this[firstError];if(node){while(node=node.parentNode){if(node.style.display=='none'){tab=node.id;break;}
if(node.nodeName=='BODY'){break;}}}
if(tab&&set_tab){debug('switch tab: '+tab);set_tab(tab);}
if(this[firstError]){this[firstError].focus();}}
jQuery('*[type=submit], *[type=image]',this).removeAttr('disabled');}else{window.onbeforeunload=null;$(this).append('<input type="hidden" name="nospam" value="1">');this.submit();}},this)});});jQuery('textarea.autogrow').bind('keyup',function(){this.style.overflow="hidden";this.style.fontSize=12+"px";var cols=this.cols;var str=this.value;str=str.replace(/\r\n?/,"\n");var lines=2;var chars=0;for(i=0;i<str.length;i++){var c=str.charAt(i);chars++;if(c=="\n"||chars==cols){lines++;chars=0;}}
if(this.rows>lines){lines=this.rows;}
this.style.height=lines*14+"px";});jQuery('textarea.autogrow').trigger('keyup');if(jQuery('select.combobox').length){jQuery("head").append("<link>");var css=jQuery("head").children(":last");css.attr({rel:"stylesheet",type:"text/css",href:"/_lib/js/jquery.ui.combobox/jquery.ui.combobox.css"});jQuery.getScript("/_lib/js/jquery.ui.combobox/jquery.ui.combobox.js").done(function(){jQuery('select.combobox').combobox();});}
if(jQuery().datepicker){jQuery('input.date').datepicker({dateFormat:'dd/mm/yy',altFormat:'dd/mm/yy'});jQuery('input.dob').datepicker({dateFormat:'dd/mm/yy',altFormat:'dd/mm/yy',changeMonth:true,changeYear:true,yearRange:'-100y:c+nn',maxDate:'-1d'});}
if(jQuery('input.map').length){google.load("maps","3",{other_params:"sensor=false","callback":function(){jQuery.each(jQuery('input.map'),function(){div=document.createElement("div");div.style.width='600px';div.style.height='400px';this.parentNode.appendChild(div);var coords=null;if(this.value){coords=this.value.split(' ');}else{coords=[51.8100844,-0.02911359999995966];}
var lat=coords[0];var lng=coords[1];var latlng=new google.maps.LatLng(lat,lng);var myOptions={zoom:10,center:latlng,mapTypeId:google.maps.MapTypeId.ROADMAP};maps[this.name]=new google.maps.Map(div,myOptions);maps[this.name].markers=[];maps[this.name].markers.push(new google.maps.Marker({map:maps[this.name],position:latlng,draggable:true}));var field=this;google.maps.event.addListener(maps[this.name].markers[0],"dragend",function(){var latlng=this.getPosition();field.value=latlng.lat()+' '+latlng.lng();});});}});}
if(jQuery('.upload').length){jQuery.getScript("/_lib/modules/phpupload/js/jquery.upload.js").done(function(){jQuery('.upload').upload();});}
if(jQuery('select.rating').length){jQuery("head").append("<link>");var ratingCss=jQuery("head").children(":last");ratingCss.attr({rel:"stylesheet",type:"text/css",href:"http://www.radioactivethinking.com/rateit/src/rateit.css"});jQuery.getScript("http://www.radioactivethinking.com/rateit/src/jquery.rateit.js").done(function(){$("select.rating").each(function(index){var field=$(this);field.hide();field.after('<div></div>').next().rateit({backingfld:field.attr('id'),resetable:true,ispreset:true,step:1,value:field.val(),readonly:field.prop('disabled')}).bind('rated',function(event,value){var field=$(this).prev();field.val(value);}).bind('reset',function(event,value){var field=$(this).prev();field.val('');});});});}
var tinymce_url='//tinymce.cachefly.net/4.1/';if(jQuery('textarea.tinymce').length){jQuery.getScript(tinymce_url+"jquery.tinymce.min.js").done(function(){$('textarea.tinymce').tinymce({script_url:tinymce_url+'tinymce.min.js',plugins:["importcss advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste textcolor"],toolbar:"insertfile undo redo | styleselect | formatselect  | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | hr link image forecolor backcolor",relative_urls:false,remove_script_host:true,content_css:"/css/style.css?"+new Date().getTime(),template_external_list_url:"lists/template_list.js",external_link_list_url:"/_lib/js/tinymce.lists/links.php",external_image_list_url:"/_lib/js/tinymce.lists/images.php",media_external_list_url:"lists/media_list.js",file_browser_callback:function(field_name,url,type,win){tinymce.activeEditor.windowManager.open({title:"File browser",url:"/_lib/modules/phpupload/?field=field_name&file=url",width:800,height:600},{oninsert:function(url){win.document.getElementById(field_name).value=url;}});},accessibility_warnings:false,popup_css:false,theme_advanced_styles:'Link to Image=lightbox',setup:function(editor){editor.addShortcut('Ctrl+219','','indent');editor.addShortcut('Ctrl+221','','outdent');}});});}
if(jQuery('ul.files').length){jQuery('ul.files').sortable();}
if(jQuery('input.combo').length){jQuery('input.combo').each(function(){jQuery(this).autocomplete({source:'_lib/cms/_ajax/autocomplete.php?field='+this.name});});}
if(jQuery('input[type="file"]').length){jQuery('input[type="file"]').change(function(evt){var input=this;var files=evt.target.files;for(var i=0,f;f=files[i];i++){if(!f.type.match('video.*')){continue;}
var reader=new FileReader();reader.onload=(function(theFile){return function(e){var video=document.createElement('video');video.style.display='none';video.src=e.target.result;input.parentNode.insertBefore(video,input.nextSibling);video.addEventListener('canplay',function(){this.currentTime=this.duration / 2;},false);video.addEventListener('seeked',function(){var filename='thumb';var w=video.videoWidth;var h=video.videoHeight;var canvas=document.createElement('canvas');canvas.width=w;canvas.height=h;var ctx=canvas.getContext('2d');ctx.drawImage(video,0,0,w,h);var data=canvas.toDataURL("image/jpg");var thumbInput=document.createElement('textarea');thumbInput.style.display='none';input.parentNode.insertBefore(thumbInput,input.nextSibling);thumbInput.name='file_thumb';thumbInput.value=data;video.parentNode.removeChild(video);},false);};})(f);reader.readAsDataURL(f);}});}
if(jQuery('span[data-id]').length){jQuery.getScript(tinymce_url+"jquery.tinymce.min.js").done(function(){var cms_save=function(){$('#saveButton').attr('disabled','disabled');var data=[];var item={};$("span[data-edited='true']").each(function(index){item=$(this).data();item.value=$(this).html();data.push(item);});$.ajax({type:"POST",url:'/_lib/cms/_ajax/save.php',data:{data:JSON.stringify(data)},success:function(data,textStatus,jqXHR){$('#saveDiv').remove();},dataType:'json'});};var cms_cancel=function(){$('#saveDiv').remove();};var tinymce_onchange=function(ed){ed.on('change',function(e){ed.bodyElement.dataset.edited=true;if(!document.getElementById('saveDiv')){var div=document.createElement("div");div.id='saveDiv';div.style.position='fixed';div.style.bottom=0;div.style.left=0;div.style.right=0;div.style.zIndex=1000;div.style.textAlign='center';div.style.background='#999';div.style.padding='3px';var saveBtn=document.createElement("BUTTON");saveBtn.id='saveButton';saveBtn.type='button';saveBtn.innerText='Save changes';saveBtn.style.margin='0px 5px';div.appendChild(saveBtn);saveBtn.onclick=cms_save;var cancelBtn=document.createElement("BUTTON");cancelBtn.id='cancelButton';cancelBtn.type='button';cancelBtn.innerText='Cancel';cancelBtn.style.margin='0px 5px';div.appendChild(cancelBtn);cancelBtn.onclick=cms_cancel;document.body.appendChild(div);}});};$('span.cms_text').tinymce({script_url:tinymce_url+'tinymce.min.js',selector:"span.cms_text",inline:true,toolbar:"undo redo",menubar:false,setup:tinymce_onchange});$('div.cms_editor').tinymce({script_url:tinymce_url+'tinymce.min.js',selector:"div.cms_editor",inline:true,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",setup:tinymce_onchange});});}}
function numbersonly(e){var unicode=e.charCode?e.charCode:e.keyCode;if(unicode!==8&&unicode!==46&&unicode!==9){if(unicode<48||unicode>57){return false;}}}
function addItem(aList,aField){phpUploadCallback=function(images){for(var i in images){if(images.hasOwnProperty(i)){var ul=document.getElementById(aList);li=document.createElement("li");var itemHTML='<input type="hidden" name="'+aField+'[]" value="'+images[i]+'" size="5"> ';itemHTML+='<img src="_inc/modules/phpupload/?func=preview&file='+images[i]+'" width="100" height="100" /><br /> ';itemHTML+='<label>'+images[i]+'</label><br />';itemHTML+='<a href="javascript:void(0)" class="link" onClick="delItem(this)">Delete</a>';li.innerHTML=itemHTML;ul.appendChild(li);}}};phpUpload();}
function delItem(field){var obj=field.parentNode;obj.parentNode.removeChild(obj);}
function clearItem(aField){var field=document.getElementById(aField);var thumb=document.getElementById(aField+'_thumb');var label=document.getElementById(aField+'_label');field.value='';thumb.src='_inc/modules/phpupload/?func=preview&file=';label.innerHTML='';}
function selectAll(field){jQuery('input').each(function(){if(this.name==field+'[]'){this.checked=true;}});}
function selectNone(field){jQuery('input').each(function(){if(this.name==field+'[]'){this.checked=false;}});}
function clearFile(field)
{var inputHidden=document.getElementById(field);inputFile=document.createElement("input");inputFile.setAttribute('name',field);inputFile.setAttribute('type','file');var cell=inputHidden.parentNode;while(cell.childNodes.length>=1)
{cell.removeChild(cell.firstChild);}
cell.appendChild(inputFile);}
function delRow(row){rows--;row.parentNode.parentNode.parentNode.deleteRow(row.parentNode.parentNode.rowIndex);}
function init_tabs()
{jQuery('.tab').each(function(index){if(index===0){set_tab(this.target);}
jQuery(this).on('mousedown',function(e){set_tab(e.target.target)});});}
function set_tab(target)
{jQuery('.tab').each(function(index){if(target==this.target){jQuery('#'+this.target).show();jQuery(this).addClass('current');}else{jQuery('#'+this.target).hide();jQuery(this).removeClass('current');}});}
jQuery(document).ready(function(){initForms();});